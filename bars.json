{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "description": "Top/bottom LGAs in 2024; toggle between Hot Days and Heat Risk Index.",
  "width": 720,
  "height": 340,
  "data": { "url": "data/metric.csv", "format": { "type": "csv" } },

  "params": [
    {
      "name": "metricChoice",
      "value": "Hot Days",
      "bind": {
        "input": "select",
        "options": ["Hot Days", "Heat Risk Index"],
        "labels": ["Hot Days (≥35°C)", "Heat Risk (Hot Days × % Aged 65+)"]
      }
    }
  ],

  "transform": [
    { "filter": "toNumber(datum.year) == 2024" },

    { "calculate": "toNumber(datum.hot_days)", "as": "hot_num" },
    { "calculate": "toNumber(datum.elderly_share)", "as": "elderly_num" },
    { "calculate": "datum.hot_num * datum.elderly_num", "as": "risk" },

    {
      "calculate": "metricChoice == 'Hot Days' ? datum.hot_num : datum.risk",
      "as": "metric_value"
    },

    {
      "window": [{"op": "rank", "as": "rank"}],
      "sort": [{"field": "metric_value", "order": "descending"}]
    },
    { "filter": "(datum.rank <= 5) || (datum.rank > 12)" }
  ],

  "mark": "bar",

  "encoding": {
    "y": { "field": "NAME", "type": "nominal", "sort": "-x", "title": "LGA" },

    "x": {
      "field": "metric_value",
      "type": "quantitative",
      "title": "Selected metric"
    },

    "color": {
      "field": "metric_value",
      "type": "quantitative",
      "scale": { "scheme": "oranges" },
      "title": "Selected metric"
    },

    "tooltip": [
      { "field": "NAME", "title": "LGA" },
      { "field": "hot_num", "title": "Hot days (≥35°C)", "format": ".1f" },
      { "field": "elderly_num", "title": "Aged 65+ (%)", "format": ".1f" },
      { "field": "risk", "title": "Risk Index (Hot × 65+)", "format": ".2f" }
    ]
  },

  "config": {
    "axis": { "labelFontSize": 12, "titleFontSize": 13 },
    "view": { "stroke": null }
  }
}
